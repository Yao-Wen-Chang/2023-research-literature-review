\section{Literature Review}
In the literature review, first, prerequisite definition of the CI/CD technique will be 
described. Then, a variety of risks and attacks are catagorized based on the three attack 
surface within the CI/CD pipeline, which are source code repository, build and test, and deploy.
Some defense methods introduced in the related work will be aligned with the attacks in this 
section. Finally, the top ten risks existed in CI/CD pipeline refering to OWASP 2023 will be 
summarised~\cite{OWASP2023}.

\subsection{Definition of CI/CD}
CI/CD is a developmentand and deployment process for automatically building and testing code
changes that support orgamizations maintain a consistent code base, then automatically shipping 
the artifact to the target customers. 'CI' involves developers frequently merging code changes 
into a central repository where automated builds and tests run. 'Build' is the process of 
converting source code into executable code. Then, running the automated tests which usually 
combined unit test and integration test against the build. These process will avoid integration 
challenges that can happen when waiting for release day to merge changes into the release branch. 
'CD' defined the process of the releases happened automatically~\cite{DoDDefCI/CD2023}. 

Nowadays, nearly all software applicaions were built on top of others works, which is called third-parites.
However, the convenience and capabilities of the third-party source code usually cause cybersecurity 
risks~\cite{mastrangelo2015use}. Software supply chain attacks aim at injecting code into software
components including source code base and artifacts, like docker image or executable software,
to compromise downstream users~\cite{ladisa2023sok}. 
Some risks and counter method will be introduced in the following sections.


\subsection{Source Code Repository}
The research\cite{garrett2019detecting} proposed anomaly detection method to cluster and detect 
the suspicious update javascript code. It shows that this unsupervised machine learning 
clustering method is able to reduce the manual review effort by 89 percent considering the worse
case that all updates are not malicious. However, the data is skewed since more unsuspicious updates
existed in the dataset. Also, the researcher devide the features based on static method by reviewing
some packages and find out the malicious code. This method is not cost efficient and only specific
to the programming languages where there are models already trained. 

Neverthless, the author in~\cite{boucher2023trojan} provide a attack approach to bypass the manual
code review. With the trojan source attacks, the attacker can embed seemingly unsuspicious unicode into
the comments and indeirectly modify the order of the code causing unexpected results. 
This would bypass the method provided by~\cite{garrett2019detecting}, 
since the this feature is not recognised by the model. The author recommend the developers to include 
Regex detection method in the 'Build' stage, since this malicious code is triggered by the compiled code.
The fundamental way to avoid being compromised by the trojan source attack is through banning the 
unicode when it is not required in the projects. Even though the recommend defense strategies 
are able to counteract this attack, but the method only deal with the specific attack against the 
CI/CD pipeline.


\subsection{Build/Test}

\subsection{Deploy}
% Java Virtual Machine (JVM) executes Java bytecode and provides strong safety
% guarantees. However, the unsafe API, "sun.misc.Unsafe", will cause serious 
% security issue if it is misused by the developers. The research~\cite{mastrangelo2015use} 
% studied a large repository, Maven, and analyzed the compiled Java code. The 
% security issues include violating type safety, crashing the virtual machine (VM)
% , uninitialized objects and so on. These misuse might impact third-party package 
% management service. 

% Decide whether to include a reference for each case and decide combine attack surface to this section
% Decide rephrasing is required
\subsection{OWASP Top 10 CI/CD Risks\cite{OWASP2023}}
\begin{enumerate}[label=(\arabic*)]
    % 1
    \item \textbf{Insufficient Flow Control Mechanisms}
    
    \textbf{Definition: }The attacker gained access to a system within CI/CD process.
    However, the system lacked sufficient enforcement to approve and review the code or the artifact
    provided by the contributors.

    \textbf{Impact: }
        \begin{itemize}
            \item The attackers can push code to a repository branch, which is automatically
            deployed to production and manually trigger by the attackers.
            \item Upload an artifact to the artifact repository, such as a package or container
            , in the guise of a legitimate artifact created by the build environment and picked 
            up by a deploy pipeline and deployed to production.
        \end{itemize}
    
    \textbf{Remediation:}
    \begin{itemize}
        \item Configure strict branch protection rules
        \item Limit the usage of auto-merge rules
        \item Prevent drifts and inconsistencies between the running code in production and its 
        CI/CD origin.
    \end{itemize}
    % 2
    \item \textbf{Inadequate identity and Access Management}
    
    \textbf{Definition: }This risks stem from the difficulties in managing the vast amount of
    identities. The identies are indentified through personal access token, e-mail, password and so on.
        \begin{itemize}
            \item Overly permissive identities
            \item Stale identies - Some identies that are not active or no longer require access but have
            no had their account deactivated.
            \item External indentities - (1) Employees registered with email from a domain not managed by 
            the organization (2) External collaborators are outside of the organization's control.
        \end{itemize}

    \textbf{Impact: }
        \begin{itemize}
            \item Overly permissive accounts leads to a state where the attacker can compromise any user
            account on any system within the CI/CD pipeline.
        \end{itemize}

    \textbf{Remediation:}
        \begin{itemize}
            \item Continuously analyzed and mapped the identies' account to their permissions, and removed the 
            the permissions not necessary to the ongoing work.
            \item Ensure the identies are aligned to the principle of least privilege, and pre-defined a expiry date 
            for the identies' permissions.
            \item Prevent the emplyees from using personal email addresses.
            \item Avoid the shared accounts. Created the dedicated accounts for each specific context.
        \end{itemize}
    % 3
    \item \textbf{Dependency Chain Abuse}

    \textbf{Definition: }
        Dependency chain abuse refer to an attacker's ability to abuse flaws relating to how 
        engineering workstations and build environments fetch code dependencies. The build system download the 
        malicious package instead of the one intended to be pull. There are four scenarios where the developers might be tricked.
        \begin{itemize}
            \item Dependency confusion - Publication of malicious packages in public repositories with the same 
            names as those private one.
            \item Obtain the control of the account of the package maintainer in order to upload the malicious version.
            \item Typosquatting - Publication of a similar names to those popular packages.
            \item Brandjacking - The malicious packages were consistent with the naming convention with the trusted brand.
        \end{itemize}

    \textbf{Impact: }
        Once the malicious code is running, it can be leveraged for credentials theft and move horizontally through a system and 
        network.

    \textbf{Remediation:}
        \begin{itemize}
            \item Ensure the packages are not directly pulled through the internet, 
            but through an internal proxy. And disallow pulling directly from external repositories.
            \item Verify checksum and signature of the pulled packages.
            \item Lock the packages' version instead of pulling the latest version.
            \item Installation scripts should not access to 
            sentitive resources in the build process.
            \item Always ensure projects contain configuration files of package managers.
            \item The most important is deploy a quick detection, 
            monitoring and mitigation to avoid further compromise.
        \end{itemize}
    % 4
    \item \textbf{Poisoned Pipeline Execution (PPE)}

    \textbf{Definition: }
        The attacker access to the source control systems, but without access to the build environment, is
        able to manipulate the build process by injecting malicious code into the build configuration file.
        There are three type of PPE, direct PPE (D-PPE), indirect PPE (I-PPE) and public-PPE (3PE).

        In the D-PPE scenario, the attackers modify the CI config files either by submitting a PR or directly pushing to the unprotected
        remote branch. Since the CI pipeline execution is triggered by push or PR events, and the CI execution
        is defined by CI Configuration file, the malicious commands run in the build node.

        In the I-PPE scenario, the pipeline is configured to pull the CI configuration file from a protected 
        branch or CI build is defined by the CI system instead of the in the file stored in the source code.
        In those cases, the attackers can still injecting malicious code into the files referenced by the pipeline
        configuration file.

        In most cases, the permissions of the access to the repository are given to the orgamization
        members. However, in the 3PE scenario, the public repositories are allowed the anonymous to 
        contribute. If the CI pipline runs unreviewed code, the repository is susceptible to the 3PE.

    \textbf{Impact: }
        \begin{itemize}
            \item Access to the secret available to the CI job.
            \item Able to ship code and artifacts futher down the pipeline, in the guise of legitimate 
            code build by the build process.
        \end{itemize}

    \textbf{Remediation:}
        \begin{itemize}
            \item Ensure that pipelines running unreviewed code are executed on isolated nodes to prevent
            exposure of sensitive information.
            \item To prevent the manipulation of the CI configuration file.
            \item Remove permissions from the users that do not need them.
        \end{itemize}
    % 5
    \item \textbf{Insufficient PBAC (Pipeline-Based Access Controls)}

    \textbf{Definition: }
        Adversary is able to execute malicious code within the context of the pipeline.
        The pipeline execution nodes have access to the resources or systems within and outside the 
        execution environment.

    \textbf{Impact: }
        Malicious code is able to run in the context of the pipeline. Probabily, this attack would lead to 
        the exposure of the secret and confidential data.
        
    \textbf{Remediation:}
        \begin{itemize}
            \item Do not use shared node for pipeline with different levels of sensitivity.
            \item Where applicable, run pipeline jobs on a separate, dedicated node.
        \end{itemize}
    % 6
    \item \textbf{Insufficient Credential Hygiene}

    \textbf{Definition: }
        CI/CD environments are built of multiple systems communicating and authenticating against each other
        through verifying the credentials. Insufficient credential Hygiene generally means the overly permissive
        or the credentials are accidently existed in CI/CD pipelines and the code repositories. Some cases are
        due to the unrotated credentials issue.  

    \textbf{Impact: }
        The adversary obtains the credentials to deploy the malicious code and artifacts.
    \textbf{Remediation:}
        \begin{itemize}
            \item Conform to the least privilege rule abd granted the exact set of permission.
            \item Avoid sharing the same sets of credentials across multiple contexts.
            \item Using temporary credentials. If using static credentials, better periodically roate
            all the static credentials and detect stale credentials.
            \item Scoping the credentials to specific source IP to ensure the credentials cannot be used
            outside the environment even if it is compromised.
            \item Detect secrets pushed to the code repositories.
        \end{itemize}
    % 7
    \item \textbf{Insecure System Configuration}

    \textbf{Definition: }
        Flaws in the security settings and configuration, which often results in easily compromised by The
        attackers. For example, the overly permissive network access controls allow the attackers to interact
        with different domain.

    \textbf{Impact: }
        The flaws may be abused by the attacker to manipulate CI/CD flows, and obtain the sensitive tokens.
    
    \textbf{Remediation:}
        \begin{itemize}
            \item Ensure the network access the systems is aligned with the principle of least access.
            \item Periodically review all system configuration.
            \item Ensure permission to pipeline execution nodes follow the least privilege principle. 
        \end{itemize}
    % 8
    \item \textbf{Ungoverned Usage of 3rd Party Services}

    \textbf{Definition: }   
        3rd party services are granted access to the organization's assets, such as the CI/CD systems.

    \textbf{Impact: }
        Lack of governance and visibility around 3rd part might allow the write permission on the repository.
        Then, the flaw is leveraged by the adversary to push the code to the repository.
    \textbf{Remediation:}
        \begin{itemize}
            \item Define the scoped context that the 3rd parties are able to access, and with strict ingress
            and egress filter.
            \item Established vetting procedures to verify the trustworthiness of the 3rd paries. Prior to being 
            granted access to the environment, the approval of being granted to resources should be verified.
        \end{itemize}
    % 9
    \item \textbf{Improper Artifact Integrity Validation}

    \textbf{Definition: }
        This flaw allow an attacker with access to the CI/CD process to push malicious code or artifacts down 
        the pipeline.

    \textbf{Impact: }
        Execution of malicious code.

    \textbf{Remediation:}
        \begin{itemize}
            \item Validate the integrity of resources all the way from development to production.
            \item Code signubg to prevent unsigned commits from flowing down the pipeline.
            \item Prior to fetching and using 3rd parties, the hash of the 3rd paries should be culculated and 
            cross referenced against the official published hash of the resource provider.
        \end{itemize}
        
    % 10
    \item \textbf{Insufficient logging and visibility}

    \textbf{Definition: }
        The risk allow the adversary to carry out malicious activities without being detected.
        For example, the permission modificaion and execution of builds.

    \textbf{Impact: }
        Fail to detect a breach may face difficulties in mitigation. Time and data are the most 
        valuable commodities to an organization under the attack.

    \textbf{Remediation:}
        \begin{itemize}
            \item First, be familiar with different systems involved in the potential threats.
            \item Make sure all relevant logs are enables.s
            \item Shipping logs to a centralized location and creating the alerts to detect malicious activities.
        \end{itemize}
\end{enumerate}



\subsection{ U.S. Department of Defense Recommend \cite{DoDDefCI/CD2023}}
\begin{enumerate}
    \item \textbf{Zero Trust Approach}
    
        No user, endpoint device or process is fully trusted.

    \item \textbf{Strong Cryptographic Algorithm}
    
        Avoid using outdated crytographic algorithm which poses a threat to CI/CD pipelines.
        The threat includes sensitive data exposure and keys generated across the CI/CD 
        pipeline.

    \item \textbf{Minimize the Use of Long-Term Credentials}

    \item \textbf{Add Signature to CI/CD Configuration and Cerify It}

        Ensure the code change is continuously signed, and the signaature is verified throughout
        CI/CD process. If the signing identity itself is compromised, it undermines trust.
    
    \item \textbf{Two-Person Rules for all Code Updates}

        The developer checks in the code which should be reviewed and approved by another 
        developer. 

\end{enumerate}

\subsection{Conclusion}

Despite the previously introduced methods seems to address all the security issues
existed in the code base and within the CI/CD, some of them may overemphasize one 
particular approach to address software supply chain security without considering 
compounding factors that impact risk.
Some of the projects aims at providing single solution that conï¬‚ates multiple 
objectives~\cite{melara2022software}.

In the next section, Supply Chain Level Security Artifacts (SLSA) will be introduced and
discussed. The framework implemented in this research is based on SLSA.

